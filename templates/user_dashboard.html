{% extends "layout.html" %}
{% block content %}
<script>
  if (!localStorage.getItem('cctv_logged_in')) {
    window.location.href = '/';
  }
</script>

<div class="row">
  <div class="col-12">
    <div class="card bg-panel border-2 mb-3">
      <div class="card-body d-flex justify-content-between align-items-center">
        <h4 class="text-warning mb-0">Live Alerts</h4>
        <div class="d-flex gap-2">
          <button id="enableSoundUser" class="btn btn-sm btn-outline-light">Enable Sound ðŸ”Š</button>
          <a class="btn btn-sm btn-secondary" href="/logout" onclick="localStorage.removeItem('cctv_logged_in');">Logout</a>
        </div>
      </div>
    </div>

    <div class="card bg-panel border-2">
      <div class="card-body">
        <div id="recent-list" class="list-group">
          {% for a in alerts %}
            <div class="list-group-item d-flex justify-content-between align-items-start">
              <div class="ms-2 me-auto">
                <div class="fw-bold">{{ a.title }}</div>
                <div class="small text-muted">{{ a.message }}</div>
              </div>
              <span class="badge bg-secondary rounded-pill">{{ a.timestamp[:19].replace('T',' ') if a.timestamp else '' }}</span>
            </div>
          {% else %}
            <div class="list-group-item">No alerts yet.</div>
          {% endfor %}
        </div>
      </div>
    </div>

  </div>
</div>

<script>
document.getElementById('enableSoundUser').addEventListener('click', () => {
  const a = new Audio('/static/sounds/alert.wav');
  a.volume = 1.0;
  a.play().then(()=>{ alert('Sound enabled'); }).catch(()=>{ alert('Tap anywhere then try again'); });
});
</script>
{% endblock %}
